{######################### CKAN #########################}
{% ckan_extends %}
{% block page %}

{######################### HTML #########################}

<!------------------------ Imports ----------------------->

<!-- CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
<style>
html {
  font-size: 100%;
}
body {background-image: none}
</style>

<!-- JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
<!------------------------ Main ----------------------->

<div class="container-fluid bg-white border rounded p-3">
  <h2> Column selection </h2>
  Select columns from the original:
  <div class="container-fluid border border-primary rounded" id="jstree">
  </div>
  <br>
</div>


<br>

<div class="container-fluid border rounded p-3">
  <h2> Custom script </h2>
  <div class="container-fluid border rounded p-3">
    <div class="form-group">
      <textarea rows="10" class="form-control bg-white border border-primary rounded" id="inputscript"></textarea>
    </div>
  </div>
  <br>
</div>

<br>

<div class="container-fluid border rounded p-3">
  <h2> Column types </h2>
  Map columns to types
  <table class="table">
    <thead>
      <tr>
        <th scope="col">Original column name</th>
        <th scope="col">Standard column name</th>
        <th scope="col">Column type</th>
      </tr>
    </thead>
    <tbody>
      {% for i in tag_list %}
      <tr>
        <td scope="row"> {{ i }} </td>
        <td>
          <div class="form-group">
            <select class="form-control" id="sel1">
              <option>lat</option>
              <option>lon</option>
              <option>name</option>
              <option>url</option>
            </select>
          </div>
        </td>
        <td>
          <div class="form-group">
            <select class="form-control" id="sel1">
              <option>int</option>
              <option>string</option>
              <option>bool</option>
              <option>float</option>
            </select>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<br>

<div>
  <button type="button" class="btn btn-secondary" onclick=save();>Save</button>
</div>

<script>
// Send schema and script
function save() {

  // Upload schema
  $.ajax({ type: "POST",
          url: window.location.origin + "/api/action/resource_create",
          headers: {"X-CKAN-API-Key": '{{ api_key }}' },
          data: {"name": "schema",
           "package_id": '{{ dataset_id }}' ,
           "type": "JSON",
           "owner_org": "testorg"},
          files: [$("#jstree").jstree(true).get_checked().toString()]
  });
  
  // Upload script
  $.ajax({ type: "POST",
          url: window.location.origin + "/api/action/resource_create",
          headers: {"X-CKAN-API-Key": '{{ api_key }}' },
          data: {"name": "script",
           "package_id": '{{ dataset_id }}' ,
           "type": "JSON",
           "owner_org": "testorg"},
          files: [$("#inputscript").val()]
  });

  
};

// JSTree
$('#jstree').jstree({
		'core' : {
			'data' : [
				{ "text" : "Root node", "children" : [
						{ "text" : "Child node 1" },
						{ "text" : "Child node 2" }
				]}
			]
		}, "plugins" : ["checkbox"]
});
</script>


{######################### CKAN #########################}
{% endblock %}
